---
title: "Is there a correlation Local Government CMS choice and Carbon Impact?"
output: html_notebook
---

# Task

Is there a correlation between CMS platform and website carbon measurement in Local Government websites?

# Data Sources

Open Innovations publish monthly snapshots of council website emissions: <https://open-innovations.github.io/council-website-emissions/> (data/council-website-emissions.csv)

Dave Briggs and Colin Stenning published the data on councils use of CMS systems: <https://sensibletech.co.uk/what-content-management-systems-are-used-in-local-government/> and <https://colinstenning.com/2021/11/10/cms-used-by-local-authorities/> (data/council-cms.csv)

# Data prep and processing

```{r}
#install packages
install.packages("urltools") 

```

```{r}
library(tidyverse)  #helps wrangle data
library(ggplot2)  #helps visualize data
library(urltools) # helps format URLs
emissions_raw <- read_csv("csv/council-website-emissions.csv")
cms_raw <- read_csv("csv/council-cms.csv")
```

council-cms.csv

-   Website URL is used as an identifier in an inconsistent format, most often: <subdomain>.<council>.gov.uk
-   Trailing slash usage is inconsistent
-   386 records
-   Renamed column to 'Website' to match other data

council-website-emissions.csv

-   ONS Code is present as an identifier
-   Website URL is present in an inconsistent format, most often: <https://><subdomain>.<council>.gov.uk
-   Trailing slash usage is inconsistent
-   408 records

```{r}
# First make a column with an extracted domain for the cms dataset
cms_urls = url_parse(cms_raw$`Council website`)
cms_domains = suffix_extract(cms_urls$domain)
cms = cbind(cms_raw, cms_domains)
View(cms)
# TODO
# Next lets make an extracted domain for the emissions dataset
emissions_urls = url_parse(emissions_raw$Website)
emissions_domains = suffix_extract(emissions_urls$domain)
emissions = cbind(emissions_raw, emissions_domains)
View(emissions)
```

## Merge data

First we need to get a dataset with all the data from council-website-emissions.csv + an extra column for the CMS, looked up from council-cms.csv.

```{r}
results = merge(emissions, cms, by = "domain", all = TRUE) %>%
  select(`ONS Code`, `Council name`, domain, CMS, `CO2 emissions (g)`)
View(results)

```

# Analysis

-   identify if cms usage is correlated to carbon emissions - each CMS - min, max and mean

```{r}
# TODO: normalise SharePoint
# TODO: get mean, min and max - show distribution
# TODO: need to fix N/A on things like Jadu
temp = results %>%
	group_by(CMS) %>%
	summarise(`Mean CO2 emissions (g)` = mean(`CO2 emissions (g)`, na.rm = TRUE),
	  `Min CO2 emissions (g)` = min(`CO2 emissions (g)`, na.rm = TRUE),
    `Max CO2 emissions (g)` = max(`CO2 emissions (g)`, na.rm = TRUE),
	  `Website Count` = n(),
	  ) %>%
  arrange(desc(`Mean CO2 emissions (g)`))
View(temp)
```
